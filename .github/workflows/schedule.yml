name: Scheduled Article Generation and Pages Deployment

on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  generate-and-deploy:
    runs-on: ubuntu-latest
    
    # ğŸš¨ ä¿®æ­£ç®‡æ‰€1: ã‚¸ãƒ§ãƒ–å…¨ä½“ã«é©ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’ã“ã“ã§è¨­å®š ğŸš¨
    env:
      ARTICLE_DIR: articles
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} # ã“ã‚Œã§å…¨ã‚¹ãƒ†ãƒƒãƒ—ã«é©ç”¨
    
    steps:
      - name: 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: 2. Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 3. ä»®æƒ³ç’°å¢ƒä½œæˆã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m venv venv
          ./venv/bin/pip install google-generativeai pydantic -U

      - name: 4. è¨˜äº‹ç”Ÿæˆã¨ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ä¿å­˜
        run: |
          # ğŸš¨ ä¿®æ­£ç®‡æ‰€2: ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã€‚env: ã¯ã‚‚ã†ä¸è¦ã§ã™ã€‚ ğŸš¨
          # GEMINI_API_KEYã¯ã‚¸ãƒ§ãƒ–å…¨ä½“ã«è¨­å®šã•ã‚ŒãŸãŸã‚ã€ã“ã“ã§ä½¿ç”¨å¯èƒ½ã§ã™ã€‚
          ./venv/bin/python generate_article.py
          
          GENERATED_FILE=$(ls *.html | head -n 1) 
          
          mkdir -p ${{ env.ARTICLE_DIR }}
          mv "$GENERATED_FILE" ${{ env.ARTICLE_DIR }}/
          
          touch index.html
        # env: <-- ã“ã“ã«ã‚ã£ãŸenv:ãƒ–ãƒ­ãƒƒã‚¯ã¯å‰Šé™¤ã—ã¦ãã ã•ã„

      - name: 5. ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨Artifactã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-pages-artifact@v3
        with:
          path: .
          
      - name: 6. GitHub Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
