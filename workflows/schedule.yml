name: Scheduled Article Generation

on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  generate_and_deploy:  # ã‚¸ãƒ§ãƒ–åã‚’å¤‰æ›´
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ (ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆç”¨)
        uses: actions/checkout@v4

      # (ã‚¹ãƒ†ãƒƒãƒ— 2, 3, 4, 5 ã¯ãã®ã¾ã¾)
      - name: 2. Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pip install -r requirements.txt

      - name: 4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã¨è¨˜äº‹ã®ç”Ÿæˆ
        id: generate  # ã‚¹ãƒ†ãƒƒãƒ—IDã‚’è¿½åŠ 
        run: python generate_article.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # --- ğŸš¨ æ–°è¦è¿½åŠ ã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ãƒ†ãƒƒãƒ— ğŸš¨ ---
      - name: 5. ç”Ÿæˆã•ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹å®šã¨ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: cpina/github-action-push-to-another-repository@main
        env:
          # ãƒ—ãƒƒã‚·ãƒ¥ã«ä½¿ç”¨ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³
          API_TOKEN_GITHUB: ${{ secrets.DEPLOY_TOKEN }}
        with:
          source-directory: './'  # ç”Ÿæˆã•ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹
          destination-github-username: 'kiruha0315-debug' # ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å
          destination-repository-name: 'kiruha0315-debug.github.io' # å…¬é–‹ã‚µã‚¤ãƒˆã®ãƒªãƒã‚¸ãƒˆãƒªå
          user-email: 'kiruha0315-debug@users.noreply.github.com' # ã‚ãªãŸã®GitHubç™»éŒ²ãƒ¡ãƒ¼ãƒ«
          commit-message: 'feat: AIã«ã‚ˆã‚‹è‡ªå‹•è¨˜äº‹ç”Ÿæˆã¨ãƒ‡ãƒ—ãƒ­ã‚¤'
          target-branch: 'main'
          # ç”Ÿæˆã•ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’å¯¾è±¡ã«ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã¯ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã§æŒ‡å®šï¼‰
          target-directory: 'articles' # è¨˜äº‹ã‚’ç½®ãå…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚©ãƒ«ãƒ€åï¼ˆä¾‹: articles/ï¼‰
          create-target-branch-if-needed: true
          # è¨˜äº‹ãƒ•ã‚¡ã‚¤ãƒ«åã®ä¸€è¦§ã‚’å‹•çš„ã«å–å¾—ã™ã‚‹ï¼ˆPythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¨™æº–å‡ºåŠ›ã™ã‚‹ãªã©ã€ã‚ˆã‚Šé«˜åº¦ãªãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ï¼‰
          # ç¾çŠ¶ã¯ãƒ‡ãƒãƒƒã‚°ç”¨ã«ã€å…¨ã¦ã® .html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã—ã¾ã™ã€‚
          target-files: '*.html'
